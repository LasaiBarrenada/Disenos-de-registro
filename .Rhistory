View(regresores)
View(regresoresFinal)
View(repes)
regresores[numidest == "'010205"]
regresores[numidest == "010205"]
setwd("M:/EIPI3/Lasai/Diseños de registro")
source("Read.R") #lectura Datos
source("CodeManagement.R") #CNAE
source('CNAEMIG.R') #Formateos YO
regresores.PGR <- data_PGR_st[,list(NUMIDEST,CN01,CN02,CN03,CN04,CN05)]
unique(regresores.PGR)
regresores <- data_PID_st[,list(numidest,cnaeest,`cnaeemp `,provem,proves,codddpp,codtame,actual,obsanual1,obsanual2,prioridp,resulta)]
repes <- as.data.frame(regresores[duplicated(regresores$numidest)]) #Varios numidest repetidos
regresores$imputar <- resultacode(regresores$resulta)
# Falta SA WE BL
# CNAE
# CNAE EMPRESA
regresores$cnaeemp3 <- substr(regresores$cnaeemp,0,3)
regresores$cnaeemp2 <- substr(regresores$cnaeemp3,0,2)
regresores$cnaeemp1 <- CNAE3toCNAE1(regresores$cnaeemp3)
# CNAE Establecimiento
regresores$cnaeest3 <- substr(regresores$cnaeest,0,3)
regresores$cnaeest2 <- substr(regresores$cnaeest3,0,2)
regresores$cnaeest1 <- CNAE3toCNAE1(regresores$cnaeest3)
regresores$match.cnae4 <- regresores$`cnaeemp ` == regresores$cnaeest
regresores$match.cnae3 <- regresores$cnaeemp3 == regresores$cnaeest3
regresores$match.cnae2 <- regresores$cnaeemp2 == regresores$cnaeest2
regresores$match.cnae1 <- regresores$cnaeemp1 == regresores$cnaeest1
# CNAE MIG
regresores$cnaeempMIG <- CNAE3toCNAEMIG(regresores$cnaeemp3)
regresores$cnaeempSub <- CNAE3toCNAESub(regresores$cnaeemp3)
regresores$cnaeestMIG <- CNAE3toCNAEMIG(regresores$cnaeest3)
regresores$cnaeestSub <- CNAE3toCNAESub(regresores$cnaeest3)
regresores$match.cnaeMIG <- regresores$cnaeempMIG == regresores$cnaeestMIG
regresores$match.cnaeSub <- regresores$cnaeempSub == regresores$cnaeestSub
# Coincide provincia
regresores$match.prov <- regresores$provem == regresores$proves
# CCAA Sacar de FDE
regresores$CAemp <- provinciaToCCAA(regresores$provem)
# Actual
regresores$actual[substr(regresores$actual,0,1)=="A"] <- "Entra"
regresores$actual[substr(regresores$actual,0,1)=="B"] <- "Sale"
regresores$actual[substr(regresores$actual,0,1)==""] <- "*"
# Obs
obs <- paste(regresores$obsanual1, regresores$obsanual2)
regresores$obs <- ifelse(obs != " ",TRUE, FALSE)
library(stringi)
obs.UTF <- stri_enc_toutf8(obs)
regresores$obs.nchar <- nchar(obs, allowNA = T) #Tiene muchos NAS porque son multibytes
regresoresTotal <- merge.data.table(regresores,regresores.fde,by = "numidest", all.x = T)
# PORQUE HAY MAS OBSERVACIONES QUE EN REGRESORES TOTAL???????????????????
regresoresFinal <- merge.data.table(regresoresTotal,regresores.PGR, by.x = "numidest", by.y = "NUMIDEST", all.x = T)
regresoresFinal[is.na(regresoresFinal$CN01)] #3020 imputaciones necesarias al menos
regresoresFinal[is.na(regresoresFinal$provem)] #3020 imputaciones necesarias al menos
numidest <- as.data.table( unique(regresoresFinal$numidest))
# Match CCAA emp y est
regresoresTotal$match.CCAA <- regresoresTotal$ccaa == regresoresTotal$CAemp
View(regresoresTotal)
View(regresoresTotal[,list(cnaeemp3,cnaeest3,cnaeempMIG,cnaeempSub,cnaeestMIG,cnaeestSub)])
View(FDE)
View(FDE[acti == "NNCC"])
View(data_PID_st[`cnaeemp ` == "NNCC"])
View(data_PID_st[cnaeemp == "NNCC"])
View(data_PID_st[,cnaeemp == "NNCC"])
View(data_PID_st[cnaeest == "NNCC"])
View(regresores[cnaeest == "NNCC"])
View(regresores[`cnaeemp ` == "NNCC"])
View(regresores)
View(regresores[ cnaeemp == "NNCC"])
regresores <- data_PID_st[,list(numidest,`cnaeemp `,provem,proves,codddpp,codtame,actual,obsanual1,obsanual2,prioridp,resulta)]
regresores.PGR <- data_PGR_st[,list(NUMIDEST,CN01,CN02,CN03,CN04,CN05)]
regresores.fde <- FDE[,list(numidest,acti,ccaa)]
regresores.PID <- data_PID_st[,list(numidest,`cnaeemp `,provem,proves,codddpp,codtame,actual,obsanual1,obsanual2,prioridp,resulta)]
# REGRESORES
setwd("M:/EIPI3/Lasai/Diseños de registro")
source("Read.R") #lectura Datos
source("CodeManagement.R") #CNAE
source('CNAEMIG.R') #Formateos YO
regresores.PGR <- data_PGR_st[,list(NUMIDEST,CN01,CN02,CN03,CN04,CN05)]
regresores.fde <- FDE[,list(numidest,acti,ccaa)]
regresores.PID <- data_PID_st[,list(numidest,`cnaeemp `,provem,proves,codddpp,codtame,actual,obsanual1,obsanual2,prioridp,resulta)]
repes <- as.data.frame(regresores.PID[duplicated(regresores.PID$numidest)]) #Varios numidest repetidos
regresores.PID$imputar <- resultacode(regresores.PID$resulta)
# Falta SA WE BL
# CNAE
# CNAE EMPRESA
regresores.PID$cnaeemp3 <- substr(regresores.PID$cnaeemp,0,3)
regresores.PID$cnaeemp2 <- substr(regresores.PID$cnaeemp3,0,2)
regresores.PID$cnaeemp1 <- CNAE3toCNAE1(regresores.PID$cnaeemp3)
# CNAE Establecimiento
regresores.PID$cnaeest3 <- substr(regresores.PID$cnaeest,0,3)
regresores.PID$cnaeest2 <- substr(regresores.PID$cnaeest3,0,2)
regresores.PID$cnaeest1 <- CNAE3toCNAE1(regresores.PID$cnaeest3)
regresores.PID$match.cnae4 <- regresores.PID$`cnaeemp ` == regresores.PID$cnaeest
regresores.PID$match.cnae3 <- regresores.PID$cnaeemp3 == regresores.PID$cnaeest3
regresores.PID$match.cnae2 <- regresores.PID$cnaeemp2 == regresores.PID$cnaeest2
regresores.PID$match.cnae1 <- regresores.PID$cnaeemp1 == regresores.PID$cnaeest1
# CNAE MIG
regresores.PID$cnaeempMIG <- CNAE3toCNAEMIG(regresores.PID$cnaeemp3)
regresores.PID$cnaeempSub <- CNAE3toCNAESub(regresores.PID$cnaeemp3)
regresores.PID$cnaeestMIG <- CNAE3toCNAEMIG(regresores.PID$cnaeest3)
regresores.PID$cnaeestSub <- CNAE3toCNAESub(regresores.PID$cnaeest3)
regresores.PID$match.cnaeMIG <- regresores.PID$cnaeempMIG == regresores.PID$cnaeestMIG
regresores.PID$match.cnaeSub <- regresores.PID$cnaeempSub == regresores.PID$cnaeestSub
# Coincide provincia
regresores.PID$match.prov <- regresores.PID$provem == regresores.PID$proves
# CCAA Sacar de FDE
regresores.PID$CAemp <- provinciaToCCAA(regresores.PID$provem)
# Actual
regresores.PID$actual[substr(regresores.PID$actual,0,1)=="A"] <- "Entra"
regresores.PID$actual[substr(regresores.PID$actual,0,1)=="B"] <- "Sale"
regresores.PID$actual[substr(regresores.PID$actual,0,1)==""] <- "*"
# Obs
obs <- paste(regresores.PID$obsanual1, regresores.PID$obsanual2)
regresores.PID$obs <- ifelse(obs != " ",TRUE, FALSE)
library(stringi)
obs.UTF <- stri_enc_toutf8(obs)
regresores.PID$obs.nchar <- nchar(obs, allowNA = T) #Tiene muchos NAS porque son multibytes
regresoresTotal <- merge.data.table(regresores.PID,regresores.fde,by = "numidest", all.x = T)
# PORQUE HAY MAS OBSERVACIONES QUE EN REGRESORES TOTAL???????????????????
regresoresFinal <- merge.data.table(regresoresTotal,regresores.PGR, by.x = "numidest", by.y = "NUMIDEST", all.x = T)
regresoresFinal[is.na(regresoresFinal$CN01)] #3020 imputaciones necesarias al menos
regresoresFinal[is.na(regresoresFinal$provem)] #3020 imputaciones necesarias al menos
numidest <- as.data.table( unique(regresoresFinal$numidest))
# Match CCAA emp y est
regresoresTotal$match.CCAA <- regresoresTotal$ccaa == regresoresTotal$CAemp
View(regresores.PID)
View(regresores.PID)
regresores <- merge.data.table(regresores,regresores.fde,by = "numidest", all.x = T)
regresores <- merge.data.table(regresores.PID,regresores.fde,by = "numidest", all.x = T)
repes <- as.data.frame(regresores[duplicated(regresores$numidest)]) #Varios numidest repetidos
View(repes)
regresores$imputar <- resultacode(regresores$resulta)
regresores.PGR <- data_PGR_st[,list(NUMIDEST,CN01,CN02,CN03,CN04,CN05)]
regresores.fde <- FDE[,list(numidest,acti,ccaa)]
regresores.PID <- data_PID_st[,list(numidest,`cnaeemp `,provem,proves,codddpp,codtame,actual,obsanual1,obsanual2,prioridp,resulta)]
regresores <- merge.data.table(regresores.PID,regresores.fde,by = "numidest", all.x = T)
repes <- as.data.frame(regresores[duplicated(regresores$numidest)]) #Varios numidest repetidos
regresores$imputar <- resultacode(regresores$resulta)
# Falta SA WE BL
# CNAE
# CNAE EMPRESA
regresores$cnaeemp3 <- substr(regresores$cnaeemp,0,3)
regresores$cnaeemp2 <- substr(regresores$cnaeemp3,0,2)
regresores$cnaeemp1 <- CNAE3toCNAE1(regresores$cnaeemp3)
# CNAE Establecimiento
regresores$cnaeest3 <- substr(regresores$acti,0,3)
regresores$cnaeest2 <- substr(regresores$cnaeest3,0,2)
regresores$cnaeest1 <- CNAE3toCNAE1(regresores$cnaeest3)
regresores$match.cnae4 <- regresores$`cnaeemp ` == regresores$acti
regresores$match.cnae3 <- regresores$cnaeemp3 == regresores$cnaeest3
regresores$match.cnae2 <- regresores$cnaeemp2 == regresores$cnaeest2
regresores$match.cnae1 <- regresores$cnaeemp1 == regresores$cnaeest1
# CNAE MIG
regresores$cnaeempMIG <- CNAE3toCNAEMIG(regresores$cnaeemp3)
regresores$cnaeempSub <- CNAE3toCNAESub(regresores$cnaeemp3)
regresores$cnaeestMIG <- CNAE3toCNAEMIG(regresores$cnaeest3)
regresores$cnaeestSub <- CNAE3toCNAESub(regresores$cnaeest3)
regresores$match.cnaeMIG <- regresores$cnaeempMIG == regresores$cnaeestMIG
regresores$match.cnaeSub <- regresores$cnaeempSub == regresores$cnaeestSub
# Coincide provincia
regresores$match.prov <- regresores$provem == regresores$proves
# CCAA Sacar de FDE
regresores$CAemp <- provinciaToCCAA(regresores$provem)
# Actual
regresores$actual[substr(regresores$actual,0,1)=="A"] <- "Entra"
regresores$actual[substr(regresores$actual,0,1)=="B"] <- "Sale"
regresores$actual[substr(regresores$actual,0,1)==""] <- "*"
# Obs
obs <- paste(regresores$obsanual1, regresores$obsanual2)
regresores$obs <- ifelse(obs != " ",TRUE, FALSE)
library(stringi)
obs.UTF <- stri_enc_toutf8(obs)
regresores$obs.nchar <- nchar(obs, allowNA = T) #Tiene muchos NAS porque son multibytes
regresoresTotal <- merge.data.table(regresores,regresores.fde,by = "numidest", all.x = T)
# PORQUE HAY MAS OBSERVACIONES QUE EN REGRESORES TOTAL???????????????????
regresoresFinal <- merge.data.table(regresoresTotal,regresores.PGR, by.x = "numidest", by.y = "NUMIDEST", all.x = T)
regresoresFinal[is.na(regresoresFinal$CN01)] #3020 imputaciones necesarias al menos
regresoresFinal[is.na(regresoresFinal$provem)] #3020 imputaciones necesarias al menos
numidest <- as.data.table( unique(regresoresFinal$numidest))
# Match CCAA emp y est
regresoresTotal$match.CCAA <- regresoresTotal$ccaa == regresoresTotal$CAemp
View(regresores)
setwd("M:/EIPI3/Lasai/Diseños de registro")
source("Read.R") #lectura Datos
source("CodeManagement.R") #CNAE
source('CNAEMIG.R') #Formateos YO
regresores.PGR <- data_PGR_st[,list(NUMIDEST,CN01,CN02,CN03,CN04,CN05)]
regresores.fde <- FDE[,list(numidest,acti,ccaa)]
regresores.PID <- data_PID_st[,list(numidest,`cnaeemp `,provem,proves,codddpp,codtame,actual,obsanual1,obsanual2,prioridp,resulta)]
regresores <- merge.data.table(regresores.PID,regresores.fde,by = "numidest", all.x = T)
repes <- as.data.frame(regresores[duplicated(regresores$numidest)]) #Varios numidest repetidos
regresores$imputar <- resultacode(regresores$resulta)
# Falta SA WE BL
# CNAE
# CNAE EMPRESA
regresores$cnaeemp3 <- substr(regresores$cnaeemp,0,3)
regresores$cnaeemp2 <- substr(regresores$cnaeemp3,0,2)
regresores$cnaeemp1 <- CNAE3toCNAE1(regresores$cnaeemp3)
# CNAE Establecimiento
regresores$cnaeest3 <- substr(regresores$acti,0,3)
regresores$cnaeest2 <- substr(regresores$cnaeest3,0,2)
regresores$cnaeest1 <- CNAE3toCNAE1(regresores$cnaeest3)
regresores$match.cnae4 <- regresores$`cnaeemp ` == regresores$acti
regresores$match.cnae3 <- regresores$cnaeemp3 == regresores$cnaeest3
regresores$match.cnae2 <- regresores$cnaeemp2 == regresores$cnaeest2
regresores$match.cnae1 <- regresores$cnaeemp1 == regresores$cnaeest1
# CNAE MIG
regresores$cnaeempMIG <- CNAE3toCNAEMIG(regresores$cnaeemp3)
regresores$cnaeempSub <- CNAE3toCNAESub(regresores$cnaeemp3)
regresores$cnaeestMIG <- CNAE3toCNAEMIG(regresores$cnaeest3)
regresores$cnaeestSub <- CNAE3toCNAESub(regresores$cnaeest3)
regresores$match.cnaeMIG <- regresores$cnaeempMIG == regresores$cnaeestMIG
regresores$match.cnaeSub <- regresores$cnaeempSub == regresores$cnaeestSub
# Coincide provincia
regresores$match.prov <- regresores$provem == regresores$proves
# CCAA Sacar de FDE
regresores$CAemp <- provinciaToCCAA(regresores$provem)
# Match CCAA emp y est
regresores$match.CCAA <- regresores$ccaa == regresores$CAemp
# Actual
regresores$actual[substr(regresores$actual,0,1)=="A"] <- "Entra"
regresores$actual[substr(regresores$actual,0,1)=="B"] <- "Sale"
regresores$actual[substr(regresores$actual,0,1)==""] <- "*"
# Obs
obs <- paste(regresores$obsanual1, regresores$obsanual2)
regresores$obs <- ifelse(obs != " ",TRUE, FALSE)
library(stringi)
obs.UTF <- stri_enc_toutf8(obs)
regresores$obs.nchar <- nchar(obs, allowNA = T) #Tiene muchos NAS porque son multibytes
regresoresTotal <- merge.data.table(regresores,regresores.fde,by = "numidest", all.x = T)
# PORQUE HAY MAS OBSERVACIONES QUE EN REGRESORES TOTAL???????????????????
regresoresFinal <- merge.data.table(regresoresTotal,regresores.PGR, by.x = "numidest", by.y = "NUMIDEST", all.x = T)
regresoresFinal[is.na(regresoresFinal$CN01)] #3020 imputaciones necesarias al menos
regresoresFinal[is.na(regresoresFinal$provem)] #3020 imputaciones necesarias al menos
numidest <- as.data.table( unique(regresoresFinal$numidest))
# REGRESORES
setwd("M:/EIPI3/Lasai/Diseños de registro")
source("Read.R") #lectura Datos
source("CodeManagement.R") #CNAE
source('CNAEMIG.R') #Formateos YO
regresores.PGR <- data_PGR_st[,list(NUMIDEST,CN01,CN02,CN03,CN04,CN05)]
regresores.fde <- FDE[,list(numidest,acti,ccaa)]
regresores.PID <- data_PID_st[,list(numidest,`cnaeemp `,provem,proves,codddpp,codtame,actual,obsanual1,obsanual2,prioridp,resulta)]
regresores <- merge.data.table(regresores.PID,regresores.fde,by = "numidest", all.x = T)
repes <- as.data.frame(regresores[duplicated(regresores$numidest)]) #Varios numidest repetidos
regresores$imputar <- resultacode(regresores$resulta)
# Falta SA WE BL
# CNAE
# CNAE EMPRESA
regresores$cnaeemp3 <- substr(regresores$cnaeemp,0,3)
regresores$cnaeemp2 <- substr(regresores$cnaeemp3,0,2)
regresores$cnaeemp1 <- CNAE3toCNAE1(regresores$cnaeemp3)
# CNAE Establecimiento
regresores$cnaeest3 <- substr(regresores$acti,0,3)
regresores$cnaeest2 <- substr(regresores$cnaeest3,0,2)
regresores$cnaeest1 <- CNAE3toCNAE1(regresores$cnaeest3)
regresores$match.cnae4 <- regresores$`cnaeemp ` == regresores$acti
regresores$match.cnae3 <- regresores$cnaeemp3 == regresores$cnaeest3
regresores$match.cnae2 <- regresores$cnaeemp2 == regresores$cnaeest2
regresores$match.cnae1 <- regresores$cnaeemp1 == regresores$cnaeest1
# CNAE MIG
regresores$cnaeempMIG <- CNAE3toCNAEMIG(regresores$cnaeemp3)
regresores$cnaeempSub <- CNAE3toCNAESub(regresores$cnaeemp3)
regresores$cnaeestMIG <- CNAE3toCNAEMIG(regresores$cnaeest3)
regresores$cnaeestSub <- CNAE3toCNAESub(regresores$cnaeest3)
regresores$match.cnaeMIG <- regresores$cnaeempMIG == regresores$cnaeestMIG
regresores$match.cnaeSub <- regresores$cnaeempSub == regresores$cnaeestSub
# Coincide provincia
regresores$match.prov <- regresores$provem == regresores$proves
# CCAA Sacar de FDE
regresores$CAemp <- provinciaToCCAA(regresores$provem)
# Match CCAA emp y est
regresores$match.CCAA <- regresores$ccaa == regresores$CAemp
# Actual
regresores$actual[substr(regresores$actual,0,1)=="A"] <- "Entra"
regresores$actual[substr(regresores$actual,0,1)=="B"] <- "Sale"
regresores$actual[substr(regresores$actual,0,1)==""] <- "*"
# Obs
obs <- paste(regresores$obsanual1, regresores$obsanual2)
regresores$obs <- ifelse(obs != " ",TRUE, FALSE)
library(stringi)
obs.UTF <- stri_enc_toutf8(obs)
regresores$obs.nchar <- nchar(obs, allowNA = T) #Tiene muchos NAS porque son multibytes
# PORQUE HAY MAS OBSERVACIONES QUE EN REGRESORES TOTAL???????????????????
regresoresFinal <- merge.data.table(regresoresTotal,regresores.PGR, by.x = "numidest", by.y = "NUMIDEST", all.x = T)
regresoresFinal[is.na(regresoresFinal$CN01)] #3020 imputaciones necesarias al menos
regresoresFinal[is.na(regresoresFinal$provem)] #3020 imputaciones necesarias al menos
numidest <- as.data.table( unique(regresoresFinal$numidest))
# REGRESORES
setwd("M:/EIPI3/Lasai/Diseños de registro")
source("Read.R") #lectura Datos
source("CodeManagement.R") #CNAE
source('CNAEMIG.R') #Formateos YO
regresores.PGR <- data_PGR_st[,list(NUMIDEST,CN01,CN02,CN03,CN04,CN05)]
regresores.fde <- FDE[,list(numidest,acti,ccaa)]
regresores.PID <- data_PID_st[,list(numidest,`cnaeemp `,provem,proves,codddpp,codtame,actual,obsanual1,obsanual2,prioridp,resulta)]
regresores <- merge.data.table(regresores.PID,regresores.fde,by = "numidest", all.x = T)
repes <- as.data.frame(regresores[duplicated(regresores$numidest)]) #Varios numidest repetidos
regresores$imputar <- resultacode(regresores$resulta)
# Falta SA WE BL
# CNAE
# CNAE EMPRESA
regresores$cnaeemp3 <- substr(regresores$cnaeemp,0,3)
regresores$cnaeemp2 <- substr(regresores$cnaeemp3,0,2)
regresores$cnaeemp1 <- CNAE3toCNAE1(regresores$cnaeemp3)
# CNAE Establecimiento
regresores$cnaeest3 <- substr(regresores$acti,0,3)
regresores$cnaeest2 <- substr(regresores$cnaeest3,0,2)
regresores$cnaeest1 <- CNAE3toCNAE1(regresores$cnaeest3)
regresores$match.cnae4 <- regresores$`cnaeemp ` == regresores$acti
regresores$match.cnae3 <- regresores$cnaeemp3 == regresores$cnaeest3
regresores$match.cnae2 <- regresores$cnaeemp2 == regresores$cnaeest2
regresores$match.cnae1 <- regresores$cnaeemp1 == regresores$cnaeest1
# CNAE MIG
regresores$cnaeempMIG <- CNAE3toCNAEMIG(regresores$cnaeemp3)
regresores$cnaeempSub <- CNAE3toCNAESub(regresores$cnaeemp3)
regresores$cnaeestMIG <- CNAE3toCNAEMIG(regresores$cnaeest3)
regresores$cnaeestSub <- CNAE3toCNAESub(regresores$cnaeest3)
regresores$match.cnaeMIG <- regresores$cnaeempMIG == regresores$cnaeestMIG
regresores$match.cnaeSub <- regresores$cnaeempSub == regresores$cnaeestSub
# Coincide provincia
regresores$match.prov <- regresores$provem == regresores$proves
# CCAA Sacar de FDE
regresores$CAemp <- provinciaToCCAA(regresores$provem)
# Match CCAA emp y est
regresores$match.CCAA <- regresores$ccaa == regresores$CAemp
# Actual
regresores$actual[substr(regresores$actual,0,1)=="A"] <- "Entra"
regresores$actual[substr(regresores$actual,0,1)=="B"] <- "Sale"
regresores$actual[substr(regresores$actual,0,1)==""] <- "*"
# Obs
obs <- paste(regresores$obsanual1, regresores$obsanual2)
regresores$obs <- ifelse(obs != " ",TRUE, FALSE)
library(stringi)
obs.UTF <- stri_enc_toutf8(obs)
regresores$obs.nchar <- nchar(obs, allowNA = T) #Tiene muchos NAS porque son multibytes
# PORQUE HAY MAS OBSERVACIONES QUE EN REGRESORES TOTAL???????????????????
regresoresFinal <- merge.data.table(regresoresTotal,regresores.PGR, by.x = "numidest", by.y = "NUMIDEST", all.x = T)
regresoresFinal[is.na(regresoresFinal$CN01)] #3020 imputaciones necesarias al menos
regresoresFinal[is.na(regresoresFinal$provem)] #3020 imputaciones necesarias al menos
numidest <- as.data.table( unique(regresoresFinal$numidest))
# REGRESORES
setwd("M:/EIPI3/Lasai/Diseños de registro")
source("Read.R") #lectura Datos
source("CodeManagement.R") #CNAE
source('CNAEMIG.R') #Formateos YO
regresores.PGR <- data_PGR_st[,list(NUMIDEST,CN01,CN02,CN03,CN04,CN05)]
regresores.fde <- FDE[,list(numidest,acti,ccaa)]
regresores.PID <- data_PID_st[,list(numidest,`cnaeemp `,provem,proves,codddpp,codtame,actual,obsanual1,obsanual2,prioridp,resulta)]
regresores <- merge.data.table(regresores.PID,regresores.fde,by = "numidest", all.x = T)
repes <- as.data.frame(regresores[duplicated(regresores$numidest)]) #Varios numidest repetidos
regresores$imputar <- resultacode(regresores$resulta)
# Falta SA WE BL
# CNAE
# CNAE EMPRESA
regresores$cnaeemp3 <- substr(regresores$cnaeemp,0,3)
regresores$cnaeemp2 <- substr(regresores$cnaeemp3,0,2)
regresores$cnaeemp1 <- CNAE3toCNAE1(regresores$cnaeemp3)
# CNAE Establecimiento
regresores$cnaeest3 <- substr(regresores$acti,0,3)
regresores$cnaeest2 <- substr(regresores$cnaeest3,0,2)
regresores$cnaeest1 <- CNAE3toCNAE1(regresores$cnaeest3)
regresores$match.cnae4 <- regresores$`cnaeemp ` == regresores$acti
regresores$match.cnae3 <- regresores$cnaeemp3 == regresores$cnaeest3
regresores$match.cnae2 <- regresores$cnaeemp2 == regresores$cnaeest2
regresores$match.cnae1 <- regresores$cnaeemp1 == regresores$cnaeest1
# CNAE MIG
regresores$cnaeempMIG <- CNAE3toCNAEMIG(regresores$cnaeemp3)
regresores$cnaeempSub <- CNAE3toCNAESub(regresores$cnaeemp3)
regresores$cnaeestMIG <- CNAE3toCNAEMIG(regresores$cnaeest3)
regresores$cnaeestSub <- CNAE3toCNAESub(regresores$cnaeest3)
regresores$match.cnaeMIG <- regresores$cnaeempMIG == regresores$cnaeestMIG
regresores$match.cnaeSub <- regresores$cnaeempSub == regresores$cnaeestSub
# Coincide provincia
regresores$match.prov <- regresores$provem == regresores$proves
# CCAA Sacar de FDE
regresores$CAemp <- provinciaToCCAA(regresores$provem)
# Match CCAA emp y est
regresores$match.CCAA <- regresores$ccaa == regresores$CAemp
# Actual
regresores$actual[substr(regresores$actual,0,1)=="A"] <- "Entra"
regresores$actual[substr(regresores$actual,0,1)=="B"] <- "Sale"
regresores$actual[substr(regresores$actual,0,1)==""] <- "*"
# Obs
obs <- paste(regresores$obsanual1, regresores$obsanual2)
regresores$obs <- ifelse(obs != " ",TRUE, FALSE)
library(stringi)
obs.UTF <- stri_enc_toutf8(obs)
regresores$obs.nchar <- nchar(obs, allowNA = T) #Tiene muchos NAS porque son multibytes
# PORQUE HAY MAS OBSERVACIONES QUE EN REGRESORES TOTAL???????????????????
regresoresFinal <- merge.data.table(regresores,regresores.PGR, by.x = "numidest", by.y = "NUMIDEST", all.x = T)
regresoresFinal[is.na(regresoresFinal$CN01)] #3020 imputaciones necesarias al menos
regresoresFinal[is.na(regresoresFinal$provem)] #3020 imputaciones necesarias al menos
numidest <- as.data.table( unique(regresoresFinal$numidest))
View(numidest)
View(regresoresFinal)
View(regresoresFinal[is.na(regresoresFinal$imputar)])
View(unique(regresoresFinal[is.na(regresoresFinal$imputar)]$resulta))
regresoresFinal[acti == 'NNCC']
regresoresFinal[`cnaeemp ` == 'NNCC']
View(regresores)
names(regresores)[2] = 'cnaeemp'
regresoresFinal[cnaeemp == 'NNCC']
regresores[cnaeemp == 'NNCC']
View(regresores[cnaeemp == 'NNCC'])
View(regresoresFinal)
View(regresoresFinal)
setwd("M:/EIPI3/Lasai/Diseños de registro")
source("Read.R") #lectura Datos
source("CodeManagement.R") #CNAE
source('CNAEMIG.R') #Formateos YO
regresores.PGR <- data_PGR_st[,list(NUMIDEST,CN01,CN02,CN03,CN04,CN05)]
regresores.fde <- FDE[,list(numidest,acti,ccaa)]
regresores.PID <- data_PID_st[,list(numidest,`cnaeemp `,provem,proves,codddpp,codtame,actual,obsanual1,obsanual2,prioridp,resulta)]
regresores <- merge.data.table(regresores.PID,regresores.fde,by = "numidest", all.x = T)
names(regresores)[2] = 'cnaeemp'
repes <- as.data.frame(regresores[duplicated(regresores$numidest)]) #Varios numidest repetidos
View(repes)
unique(repes$numidest)
numirepe <- unique(repes$numidest)
write.csv(numirepe, file = "Repes.csv")
write.csv(numirepe, file = "Repes.csv", sep = ";")
?write.csv
write.csv(numirepe, file = "Repes.csv", sep = ";")
write.csv(numirepe, file = "Repes.csv", sep = " ; ")
library("xlsx")
write.xlsx(numirepe, file = "Repes.xlsx", sheet = "sheet1")
View(repes)
View(repes)
regresores$cnaeemp == "NNCC"
regresores[regresores$cnaeemp == "NNCC"]
View(data_PGR_st)
View(data_PID_st)
unique(data_PID_st)
View(data_PID_st)
View(data_PID_st$numidest)
unique(regresores.PID)
View(regresores.PID)
unique(regresores.PID$numidest)
duplicated(regresores.PID$numidest)
duplicated(data_PID_st$numidest)
View(data_PID_st[duplicated(data_PID_st$numidest)])
install.packages("Ranger")
install.packages("ranger")
library(ranger)
library(ranger)
source("Regresores.R")
setwd("M:/EIPI3/Lasai/Diseños de registro")
library("xlsx")
source("Read.R") #lectura Datos
source("CodeManagement.R") #CNAE
source('CNAEMIG.R') #Formateos YO
library(ranger)
source("Regresores.R")
setwd("M:/EIPI3/Lasai/Diseños de registro")
library("xlsx")
source("Read.R") #lectura Datos
source("CodeManagement.R") #CNAE
source('CNAEMIG.R') #Formateos YO
regresores.PGR <- data_PGR_st[,list(NUMIDEST,CN01,CN02,CN03,CN04,CN05)]
regresores.fde <- FDE[,list(numidest,acti,ccaa)]
regresores.PID <- data_PID_st[,list(numidest,`cnaeemp `,provem,proves,codddpp,codtame,actual,obsanual1,obsanual2,prioridp,resulta)]
regresores <- merge.data.table(regresores.PID,regresores.fde,by = "numidest", all.x = T)
names(regresores)[2] = 'cnaeemp'
repes <- as.data.frame(regresores[duplicated(regresores$numidest)]) #Varios numidest repetidos
numirepe <- unique(repes$numidest)
write.xlsx(numirepe, file = "Repes.xlsx", sheet = "sheet1")
regresores$imputar <- resultacode(regresores$resulta)
# CNAE EMPRESA
regresores$cnaeemp3 <- substr(regresores$cnaeemp,0,3)
regresores$cnaeemp2 <- substr(regresores$cnaeemp3,0,2)
regresores$cnaeemp1 <- CNAE3toCNAE1(regresores$cnaeemp3)
# CNAE Establecimiento
regresores$cnaeest3 <- substr(regresores$acti,0,3)
regresores$cnaeest2 <- substr(regresores$cnaeest3,0,2)
regresores$cnaeest1 <- CNAE3toCNAE1(regresores$cnaeest3)
regresores$match.cnae4 <- regresores$`cnaeemp ` == regresores$acti
regresores$match.cnae3 <- regresores$cnaeemp3 == regresores$cnaeest3
regresores$match.cnae2 <- regresores$cnaeemp2 == regresores$cnaeest2
regresores$match.cnae1 <- regresores$cnaeemp1 == regresores$cnaeest1
regresores$cnaeempMIG <- CNAE3toCNAEMIG(regresores$cnaeemp3)
regresores$cnaeempSub <- CNAE3toCNAESub(regresores$cnaeemp3)
regresores$cnaeestMIG <- CNAE3toCNAEMIG(regresores$cnaeest3)
regresores$cnaeestSub <- CNAE3toCNAESub(regresores$cnaeest3)
regresores$match.cnaeMIG <- regresores$cnaeempMIG == regresores$cnaeestMIG
regresores$match.cnaeSub <- regresores$cnaeempSub == regresores$cnaeestSub
regresores$match.prov <- regresores$provem == regresores$proves
# CCAA Sacar de FDE
regresores$CAemp <- provinciaToCCAA(regresores$provem)
regresores$match.CCAA <- regresores$ccaa == regresores$CAemp
# Actual
regresores$actual[substr(regresores$actual,0,1)=="A"] <- "Entra"
regresores$actual[substr(regresores$actual,0,1)=="B"] <- "Sale"
regresores$actual[substr(regresores$actual,0,1)==""] <- "*"
obs <- paste(regresores$obsanual1, regresores$obsanual2)
regresores$obs <- ifelse(obs != " ",TRUE, FALSE)
library(stringi)
obs.UTF <- stri_enc_toutf8(obs)
regresores$obs.nchar <- nchar(obs, allowNA = T) #Tiene muchos NAS porque son multibytes
# PORQUE HAY MAS OBSERVACIONES QUE EN REGRESORES TOTAL???????????????????
regresoresFinal <- merge.data.table(regresores,regresores.PGR, by.x = "numidest", by.y = "NUMIDEST", all.x = T)
regresoresFinal[is.na(regresoresFinal$CN01)] #3020 imputaciones necesarias al menos
regresoresFinal[is.na(regresoresFinal$provem)] #3020 imputaciones necesarias al menos
numidest <- as.data.table( unique(regresoresFinal$numidest))
library(ranger)
source("Regresores.R")
library(ranger)
source("Regresores.R")
library(ranger)
source("Regresores.R")
View(regresoresFinal)
